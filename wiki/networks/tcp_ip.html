<!DOCTYPE html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="generator" content="pandoc" />




<link rel="stylesheet" href="/style.css" type="text/css" />



</head>


<body>
<div id="wrapper">

<div id="all">
    <div id="header">
        <p class="header_titleline">syzfeng的个人Wiki</p>
        <p class="header_subline">一切思考，都将在此记录</p>
        <p class="header_subline"><a href="/index.html">首页</a></p>
</div>


 <!--if(title)-->

 <!--if(toc)-->

<!---TCP/IP头部定义-->
<p>4层网络模型常见协议：</p>
<div class="figure">
<img src="net_proto.gif" alt="net_proto" /><p class="caption">net_proto</p>
</div>
<p>IP头部：</p>
<div class="figure">
<img src="ip.gif" alt="ip" /><p class="caption">ip</p>
</div>
<p>TCP头部：</p>
<div class="figure">
<img src="tcp.gif" alt="tcp" /><p class="caption">tcp</p>
</div>
各层协议头定义：
<pre class="brush: c">

#ifndef LITTLE_ENDIAN  
#define LITTLE_ENDIAN   (1)   //BYTE ORDER  
#else  
#error Redefine LITTLE_ORDER  
#endif 
//Mac头部，总长度14字节  
typedef struct _eth_hdr  
{  
        unsigned char dstmac[6]; //目标mac地址  
        unsigned char srcmac[6]; //源mac地址  
        unsigned short eth_type; //以太网类型  
}eth_hdr; 

//arp  
typedef struct arphdr  
{  
    u_short ar_hrd;  
    u_short ar_pro;  
    u_char ar_hln;  
    u_char ar_pln;  
    u_short ar_op;  
}ARP_HEADER; 

//IP头部，总长度20字节  
typedef struct _ip_hdr  
{  
    #if LITTLE_ENDIAN  
    unsigned char ihl:4;     //首部长度  
    unsigned char version:4, //版本   
    #else  
    unsigned char version:4, //版本  
    unsigned char ihl:4;     //首部长度  
    #endif  
    unsigned char tos;       //服务类型  
    unsigned short tot_len;  //总长度  
    unsigned short id;       //标志  
    unsigned short frag_off; //分片偏移  
    unsigned char ttl;       //生存时间  
    unsigned char protocol;  //协议  
    unsigned short chk_sum;  //检验和  
    struct in_addr srcaddr;  //源IP地址  
    struct in_addr dstaddr;  //目的IP地址  
}ip_hdr;  

//TCP头部，总长度20字节  
typedef struct _tcp_hdr  
{  
    unsigned short src_port;    //源端口号  
    unsigned short dst_port;    //目的端口号  
    unsigned int seq_no;        //序列号  
    unsigned int ack_no;        //确认号  
    #if LITTLE_ENDIAN  
    unsigned char reserved_1:4; //保留6位中的4位首部长度  
    unsigned char thl:4;        //tcp头部长度  
    unsigned char flag:6;       //6位标志  
    unsigned char reseverd_2:2; //保留6位中的2位  
    #else  
    unsigned char thl:4;        //tcp头部长度  
    unsigned char reserved_1:4; //保留6位中的4位首部长度  
    unsigned char reseverd_2:2; //保留6位中的2位  
    unsigned char flag:6;       //6位标志   
    #endif  
    unsigned short wnd_size;    //16位窗口大小  
    unsigned short chk_sum;     //16位TCP检验和  
    unsigned short urgt_p;      //16为紧急指针  
}tcp_hdr;  

//UDP头部，总长度8字节  
typedef struct _udp_hdr  
{  
    unsigned short src_port; //远端口号  
    unsigned short dst_port; //目的端口号  
    unsigned short uhl;      //udp头部长度  
    unsigned short chk_sum;  //16位udp检验和  
}udp_hdr;  

//ICMP头部，总长度4字节  
typedef struct _icmp_hdr  
{  
    unsigned char icmp_type;   //类型  
    unsigned char code;        //代码  
    unsigned short chk_sum;    //16位检验和  
}icmp_hdr;   

</pre>

<!--Baidu tongji-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?c33f8eb1bbd2cf29ae19a3492ccca0c6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    })();
</script>
<!--Baidu tongji-->
<div id="date"> </div>
<div id="liuyan">
    <!-- UY BEGIN -->
    <div id="uyan_frame"></div>
    <script type="text/javascript" id="UYScript" src="http://v1.uyan.cc/js/iframe.js?UYUserId=1789306" async=""></script>
    <!-- UY END -->
</div>
<div id="footer">
    <p class="footer_subline">Contact: shi.qinfeng@infogence.com.cn</p>
</div>
<!--SyntaxHighlighter-->
<script type="text/javascript" src="/scripts/shCore.js"></script>
<script type="text/javascript" src="/scripts/shBrushBash.js"></script>
<script type="text/javascript" src="/scripts/shBrushPython.js"></script>
<script type="text/javascript" src="/scripts/shBrushCpp.js"></script>
<script type="text/javascript" src="/scripts/shBrushJScript.js"></script>
<script type="text/javascript" src="/scripts/shBrushJava.js"></script>
<script type="text/javascript" src="/scripts/shBrushXml.js"></script>
<!---<link type="text/css" rel="stylesheet" href="/styles/shThemeFadeToGrey.css"/>-->
<link type="text/css" rel="stylesheet" href="/styles/shThemeFadeToGrey.css" /> 
<script type="text/javascript">
    SyntaxHighlighter.all()
</script>
</div> <!--wrapper-->
</body>
</html>
