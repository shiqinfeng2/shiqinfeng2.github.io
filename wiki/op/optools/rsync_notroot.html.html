<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="generator" content="pandoc" />




<link rel="stylesheet" href="../../../../style.css" type="text/css" />


<title>非root用户搭建rsync服务</title>
<meta name="keywords" content="mac,linux,rsync">

<!--SyntaxHighlighter-->
<script type="text/javascript" src="scripts/shCore.js"></script>
<script type="text/javascript" src="scripts/shBrushPython.js"></script>
<script type="text/javascript" src="scripts/shBrushJScript.js"></script>
<link type="text/css" rel="stylesheet" href="styles/shCoreFadeToGrey.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>

</head>


<body>
<div id="wrapper">

<div id="header">
    <p class="header_titleline">Mike的分享空间</p>
    <p class="header_subline"><a href="/index.html">首页</a></p>
</div>
<h1>非root用户搭建rsync服务</h1>

 <!--if(title)-->

 <!--if(toc)-->

<!---title:非root用户搭建rsync服务-->
<!---keywords:mac,linux,rsync-->
<p>我们一般如果有root权限配置,利用xinetd来配置rsync服务是很常用的一种方法.但在安全的系统里面都是使用其它账号,又有同步文件的需求,不能使用ssh,rsync服务是一个不错的选择.</p>
<h2 id="优点">优点</h2>
<ul>
<li>简单明了.</li>
<li>无需ssh,可以自己定义端口.</li>
<li>保持rsync的特性,文件的时间权限全一样.</li>
<li>传输快速.</li>
<li>可以进行检查和增量同步.</li>
</ul>
<h2 id="配置文件">配置文件</h2>
<pre><code>log file=/tmp/rsyncd.log
hosts allow = 10.0.0.0/8  127.0.0.1 
hosts deny = * 
list = true
read only = no
use chroot = false

[temp_copy]
path = /home/temp_copy
uid = user
gid = group</code></pre>
<h2 id="启动服务">启动服务</h2>
<pre><code>/usr/bin/rsync --daemon -v --port=8090 --config=rsyncd.conf</code></pre>
<ul>
<li>问题: 远程ssh执行这个不会成功,这个原因还没有具体看.</li>
</ul>
<h2 id="客户端发送">客户端发送</h2>
<pre><code>rsync -av  --exclude=status/*  --exclude=log/*  --port=8090  -R ./ x.x.x.x::temp_copy</code></pre>
<ul>
<li>注意是在当前目录使用 -R ./</li>
<li>如果不想传输,只想检查可以添加 -n</li>
</ul>
<h2 id="遇到的问题">遇到的问题</h2>
<ul>
<li>问题1: <span class="citation">@ERROR</span>: chroot failed
<ul>
<li>解决:配置添加 use chroot = false</li>
<li>相关链接: <a href="http://stackoverflow.com/questions/16267507/rsync-server-fails">参考地址</a></li>
</ul></li>
<li>问题2: <span class="citation">@ERROR</span>: chdir failed
<ul>
<li>解决: 配置文件 里面的目录没有创建,或者相应的权限不对.</li>
</ul></li>
</ul>

<div id="footer">
    <p class="footer_titleline">Human knowledge belongs to the world</p>
    <p class="footer_subline">Contact: wytabc@126.com</p>
    <p class="footer_subline">声明: 本站如有侵权行为请及时通知至以上邮箱</p>
</div>
</div> <!--wrapper-->
</body>
</html>
